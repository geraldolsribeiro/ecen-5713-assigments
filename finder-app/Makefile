# https://www.coursera.org/learn/linux-system-programming-introduction-to-buildroot/supplement/U1Beh/assignment-2-instructions
#
# 4. Write a Makefile which includes:
#
# A default target which builds the “writer” application
#
# A clean target which removes the “writer” application and all .o files
#
# Support for cross-compilation.  You should be able to generate an application
# for the native build platform when GNU make variable CROSS_COMPILE is not
# specified on the make command line.  When CROSS_COMPILE is specified with
# aarch64-none-linux-gnu- (note the trailing -)your makefile should compile
# successfully using the cross compiler installed in step 1.

CC=$(CROSS_COMPILE)gcc

all: writer

writer: writer.c
	$(CC) $(CFLAGS) $^ -o $@ $(LDFLAGS)

clean:
	rm -f writer

CROSS_COMPILE_TXT=../assignments/assignment2/cross-compile.txt 
FILE_RESULT_TXT=../assignments/assignment2/fileresult.txt

cross:
	$(MAKE) CROSS_COMPILE=aarch64-none-linux-gnu- clean all
	file writer
	mkdir -p ../assignments/assignment2/
	echo "Generated by finder-app/Makefile with target cross" > $(CROSS_COMPILE_TXT)
	aarch64-none-linux-gnu-gcc -v >> $(CROSS_COMPILE_TXT) 2>&1 
	aarch64-none-linux-gnu-gcc -print-sysroot >> $(CROSS_COMPILE_TXT)
	file writer > $(FILE_RESULT_TXT)
